---
const navLinks = [
  { href: '/chi-sono', label: 'Chi Sono' },
  { href: '/servizi', label: 'Servizi' },
  { href: '/portfolio', label: 'Portfolio' },
  { href: '/dicono-di-me', label: 'Dicono di Me' },
  { href: '/contatti', label: 'Contatti' },
];
---

<header id="navbar" class="fixed top-0 left-0 right-0 z-50 pt-6 lg:pt-10 transition-colors duration-500">
  <nav class="max-w-[1280px] mx-auto px-4 lg:px-6 flex items-center justify-between h-16 lg:h-24">
    <!-- Logo -->
    <a
      href="/"
      id="navbar-logo"
      class="font-serif text-[1.4rem] font-medium tracking-[0.12em] transition-colors duration-500 text-charcoal"
    >
      GAIA EVENTS
    </a>

    <!-- Desktop Nav -->
    <ul class="hidden lg:flex items-center gap-9">
      {navLinks.map((link) => (
        <li>
          <a
            href={link.href}
            class="navbar-link font-sans text-[0.8rem] tracking-[0.12em] uppercase transition-colors duration-500 text-charcoal hover:opacity-70"
          >
            {link.label}
          </a>
        </li>
      ))}
    </ul>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-btn"
      type="button"
      class="lg:hidden font-sans text-[0.65rem] tracking-[0.15em] uppercase border border-current px-4 py-2 transition-colors duration-500 text-charcoal"
      aria-label="Apri menu"
      aria-expanded="false"
    >
      Menu
    </button>
  </nav>
</header>

<!-- Mobile Menu Overlay -->
<div
  id="mobile-menu"
  class="fixed inset-0 bg-ivory z-40 flex flex-col opacity-0 pointer-events-none transition-opacity duration-300"
>
  <div class="flex items-center justify-between px-4 pt-6 h-[calc(1.5rem+4rem)]">
    <a href="/" class="font-serif text-[1.4rem] font-medium tracking-[0.12em] text-charcoal">
      GAIA EVENTS
    </a>
    <button
      id="mobile-menu-close"
      type="button"
      class="font-sans text-[0.65rem] tracking-[0.15em] uppercase border border-charcoal px-4 py-2 text-charcoal"
      aria-label="Chiudi menu"
    >
      Chiudi
    </button>
  </div>

  <nav class="flex-1 flex flex-col items-center justify-center gap-8">
    {navLinks.map((link) => (
      <a
        href={link.href}
        class="mobile-nav-link font-serif text-3xl text-charcoal hover:text-bordeaux transition-colors duration-300"
      >
        {link.label}
      </a>
    ))}
    <a
      href="/contatti"
      class="mt-6 inline-block bg-gold text-charcoal font-sans text-[0.75rem] tracking-[0.15em] uppercase px-10 py-4 hover:bg-gold/90 transition-colors duration-300"
    >
      Richiedi Preventivo
    </a>
  </nav>
</div>

<script>
  document.addEventListener('astro:page-load', () => {
    // --- Mobile menu ---
    const menuBtn = document.getElementById('mobile-menu-btn');
    const menuClose = document.getElementById('mobile-menu-close');
    const mobileMenu = document.getElementById('mobile-menu');

    function openMenu() {
      if (!mobileMenu || !menuBtn) return;
      mobileMenu.classList.remove('opacity-0', 'pointer-events-none');
      mobileMenu.classList.add('opacity-100', 'pointer-events-auto');
      menuBtn.setAttribute('aria-expanded', 'true');
      document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
      if (!mobileMenu || !menuBtn) return;
      mobileMenu.classList.add('opacity-0', 'pointer-events-none');
      mobileMenu.classList.remove('opacity-100', 'pointer-events-auto');
      menuBtn.setAttribute('aria-expanded', 'false');
      document.body.style.overflow = '';
    }

    menuBtn?.addEventListener('click', openMenu);
    menuClose?.addEventListener('click', closeMenu);
    mobileMenu?.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', closeMenu);
    });

    // --- Navbar theme switching ---
    const navbar = document.getElementById('navbar');
    const logo = document.getElementById('navbar-logo');
    const navbarLinks = document.querySelectorAll('.navbar-link');
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');

    function applyTheme(theme: string) {
      if (!navbar || !logo) return;

      if (theme === 'dark') {
        logo.classList.remove('text-charcoal');
        logo.classList.add('text-ivory');
        navbarLinks.forEach((link) => {
          link.classList.remove('text-charcoal');
          link.classList.add('text-ivory');
        });
        if (mobileMenuBtn) {
          mobileMenuBtn.classList.remove('text-charcoal');
          mobileMenuBtn.classList.add('text-ivory');
        }
      } else {
        logo.classList.remove('text-ivory');
        logo.classList.add('text-charcoal');
        navbarLinks.forEach((link) => {
          link.classList.remove('text-ivory');
          link.classList.add('text-charcoal');
        });
        if (mobileMenuBtn) {
          mobileMenuBtn.classList.remove('text-ivory');
          mobileMenuBtn.classList.add('text-charcoal');
        }
      }
    }

    function detectTheme() {
      const navbarHeight = 112;
      const sections = document.querySelectorAll<HTMLElement>('[data-navbar-theme]');
      let currentTheme = 'light';

      sections.forEach((section) => {
        const rect = section.getBoundingClientRect();
        if (rect.top <= navbarHeight && rect.bottom > navbarHeight) {
          currentTheme = section.dataset.navbarTheme || 'light';
        }
      });

      applyTheme(currentTheme);
    }

    // Run on scroll and on load
    detectTheme();
    window.addEventListener('scroll', detectTheme, { passive: true });
  });
</script>
