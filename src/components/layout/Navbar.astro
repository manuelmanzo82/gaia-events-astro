---
interface Props {
  logo?: string;
}

const { logo } = Astro.props;

const navLinks = [
  { href: '/chi-sono', label: 'Chi Sono' },
  { href: '/servizi', label: 'Servizi' },
  { href: '/portfolio', label: 'Portfolio' },
  { href: '/dicono-di-me', label: 'Dicono di Me' },
  { href: '/contatti', label: 'Contatti' },
  { href: '/preventivo', label: 'Preventivo' },
];
---

<header id="navbar" class="fixed top-0 left-0 right-0 z-50 pt-4 lg:pt-6 transition-colors duration-500">
  <nav class="max-w-[1280px] mx-auto px-4 lg:px-6 flex items-center justify-between">
    <!-- Logo -->
    <a
      href="/"
      id="navbar-logo"
      class="navbar-themed font-serif text-[1.4rem] font-medium tracking-[0.12em] transition-colors duration-500"
    >
      {logo ? (
        <img id="navbar-logo-img" src={logo} alt="Gaia Events" class="h-[80px] lg:h-[130px] w-auto object-contain transition-[filter] duration-500" />
      ) : (
        'GAIA EVENTS'
      )}
    </a>

    <!-- Desktop Nav -->
    <ul class="hidden lg:flex items-center gap-9">
      {navLinks.map((link) => (
        <li>
          <a
            href={link.href}
            class="navbar-themed font-sans text-[0.8rem] tracking-[0.12em] uppercase transition-colors duration-500 hover:opacity-70"
          >
            {link.label}
          </a>
        </li>
      ))}
    </ul>

    <!-- Mobile Hamburger Button -->
    <button
      id="mobile-menu-btn"
      type="button"
      class="lg:hidden relative w-8 h-8 flex items-center justify-center"
      aria-label="Apri menu"
      aria-expanded="false"
    >
      <div id="hamburger-icon" class="w-6 flex flex-col gap-[5px] transition-all duration-300">
        <span class="navbar-themed-bar block h-[1.5px] w-full bg-current transition-all duration-300 origin-center"></span>
        <span class="navbar-themed-bar block h-[1.5px] w-full bg-current transition-all duration-300 origin-center"></span>
        <span class="navbar-themed-bar block h-[1.5px] w-full bg-current transition-all duration-300 origin-center"></span>
      </div>
    </button>
  </nav>
</header>

<!-- Mobile Menu Overlay -->
<div
  id="mobile-menu"
  class="fixed inset-0 bg-ivory z-40 flex flex-col translate-x-full transition-transform duration-400 ease-in-out"
>
  <div class="flex items-center justify-between px-4 pt-4">
    <a href="/" class="font-serif text-[1.4rem] font-medium tracking-[0.12em] text-charcoal">
      {logo ? (
        <img id="mobile-menu-logo-img" src={logo} alt="Gaia Events" class="h-[80px] w-auto object-contain" />
      ) : (
        'GAIA EVENTS'
      )}
    </a>
    <button
      id="mobile-menu-close"
      type="button"
      class="relative w-8 h-8 flex items-center justify-center"
      aria-label="Chiudi menu"
    >
      <span class="block absolute h-[1.5px] w-6 bg-charcoal rotate-45"></span>
      <span class="block absolute h-[1.5px] w-6 bg-charcoal -rotate-45"></span>
    </button>
  </div>

  <nav class="flex-1 flex flex-col items-center justify-center gap-8">
    {navLinks.map((link) => (
      <a
        href={link.href}
        class="mobile-nav-link font-serif text-3xl text-charcoal hover:text-bordeaux transition-colors duration-300"
      >
        {link.label}
      </a>
    ))}
    <a
      href="/contatti"
      class="mt-6 inline-block bg-gold text-charcoal font-sans text-[0.75rem] tracking-[0.15em] uppercase px-10 py-4 hover:bg-gold/90 transition-colors duration-300"
    >
      Richiedi Preventivo
    </a>
  </nav>
</div>

<!-- Inline script: theme switching + mobile menu -->
<script is:inline>
  (function() {
    // ─── Theme switching ───
    function applyNavbarTheme() {
      var items = document.querySelectorAll('.navbar-themed');
      var bars = document.querySelectorAll('.navbar-themed-bar');
      var sections = document.querySelectorAll('[data-navbar-theme]');
      var logoImg = document.getElementById('navbar-logo-img');
      var navbarHeight = 112;
      var currentTheme = 'light';

      for (var i = 0; i < sections.length; i++) {
        var rect = sections[i].getBoundingClientRect();
        if (rect.top <= navbarHeight && rect.bottom > navbarHeight) {
          currentTheme = sections[i].getAttribute('data-navbar-theme') || 'light';
        }
      }

      for (var j = 0; j < items.length; j++) {
        if (currentTheme === 'dark') {
          items[j].classList.remove('text-charcoal');
          items[j].classList.add('text-ivory');
        } else {
          items[j].classList.remove('text-ivory');
          items[j].classList.add('text-charcoal');
        }
      }

      // Hamburger bars color
      for (var b = 0; b < bars.length; b++) {
        if (currentTheme === 'dark') {
          bars[b].classList.remove('bg-charcoal');
          bars[b].classList.add('bg-ivory');
        } else {
          bars[b].classList.remove('bg-ivory');
          bars[b].classList.add('bg-charcoal');
        }
      }

      if (logoImg) {
        logoImg.style.filter = currentTheme === 'dark' ? 'brightness(0) invert(1)' : 'none';
      }
    }

    applyNavbarTheme();
    window.addEventListener('scroll', applyNavbarTheme, { passive: true });
    document.addEventListener('astro:page-load', applyNavbarTheme);
    document.addEventListener('DOMContentLoaded', applyNavbarTheme);

    // ─── Mobile menu ───
    function initMobileMenu() {
      var menuBtn = document.getElementById('mobile-menu-btn');
      var menuClose = document.getElementById('mobile-menu-close');
      var mobileMenu = document.getElementById('mobile-menu');
      var hamburger = document.getElementById('hamburger-icon');

      if (!menuBtn || !mobileMenu) return;

      function openMenu() {
        mobileMenu.classList.remove('translate-x-full');
        mobileMenu.classList.add('translate-x-0');
        menuBtn.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';
        // Animate hamburger to X
        if (hamburger) {
          var spans = hamburger.querySelectorAll('span');
          if (spans[0]) { spans[0].style.transform = 'rotate(45deg) translate(4px, 4px)'; }
          if (spans[1]) { spans[1].style.opacity = '0'; }
          if (spans[2]) { spans[2].style.transform = 'rotate(-45deg) translate(4px, -4px)'; }
        }
      }

      function closeMenu() {
        mobileMenu.classList.add('translate-x-full');
        mobileMenu.classList.remove('translate-x-0');
        menuBtn.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
        // Reset hamburger
        if (hamburger) {
          var spans = hamburger.querySelectorAll('span');
          if (spans[0]) { spans[0].style.transform = ''; }
          if (spans[1]) { spans[1].style.opacity = ''; }
          if (spans[2]) { spans[2].style.transform = ''; }
        }
      }

      menuBtn.addEventListener('click', openMenu);
      if (menuClose) menuClose.addEventListener('click', closeMenu);

      var links = mobileMenu.querySelectorAll('a');
      for (var i = 0; i < links.length; i++) {
        links[i].addEventListener('click', closeMenu);
      }
    }

    // Run on DOMContentLoaded and astro:page-load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMobileMenu);
    } else {
      initMobileMenu();
    }
    document.addEventListener('astro:page-load', initMobileMenu);
  })();
</script>
